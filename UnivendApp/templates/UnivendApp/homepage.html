{% extends 'UnivendApp/base.html' %}
{% load static %}

{% block stylesheet %}
    <link href="{% static 'css/homepage-style.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <!-- Search Section -->
    <div class="search-section">
        <form class="search-bar" action="{% url 'search' %}" method="get">
            <span class="material-icons-round">search</span>
            <input type="text" name="q" value="{{ query|default:'' }}" placeholder="Search products or services...">
        </form>
    </div>
    <!-- Categories Grid -->
    <div class="categories-scroll">
        <a href="{% url 'home' %}" class="category{% if not selected_category %} active{% endif %}" style="text-decoration: none;">
            <span class="material-icons-round">grid_view</span> All
        </a>
        {% for cat in categories %}
            <a style="color: black; text-decoration: none;" href="{% url 'search' %}?category={{ cat.id }}" class="category{% if selected_category|default:'' == cat.id|stringformat:'s' %} active{% endif %}" style="text-decoration: none;">
                <span class="material-icons-round"  >{{ cat.icon|default:"grid_view" }}</span> {{ cat.name }}
            </a>
        {% endfor %}
    </div>

    {% if query or selected_category %}
    <!-- Search Results -->
    <div class="listings-section">
        <h2>Search Results{% if query %} for "{{ query }}"{% endif %}</h2>
        {% if listings %}
        <div class="listings-grid">
            {% for listing in listings %}
                <div class="listing-card">
                    <div class="listing-image">
                        <a href="{% url 'product-detail' listing_id=listing.id %}">
                            <img src="{% if listing.images.first.image %}{{ listing.images.first.image.url }}{% else %}https://via.placeholder.com/150{% endif %}" alt="{{ listing.title }}">
                            {% if listing.created_at|timesince < "3 days" %}
                                <span class="listing-badge" style="text-transform: uppercase;">new</span>
                            {% elif listing.saves.count > 10 %}
                                <span class="listing-badge" style="text-transform: uppercase;">popular</span>
                            {% endif %}
                        </a>
                    </div>
                    <div class="listing-content">
                        <h3>{{ listing.title }}</h3>
                        <p>{{ listing.description|truncatechars:20 }}</p>
                        <div class="listing-footer">
                            <span class="price">
                                {% if listing.price_type == 'free' %}
                                    Free
                                {% elif listing.price_type == 'hourly' %}
                                    â‚¦{{ listing.price }}/hr
                                {% else %}
                                    â‚¦{{ listing.price }}
                                {% endif %}
                            </span> <br>
                            <span class="location">{{ listing.location }}</span>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        {% else %}
            <p>No results found.</p>
        {% endif %}
    </div>
    {% else %}

    <!-- Featured Section -->
    <div class="featured-section">
        <h2>Featured ðŸ”¥</h2>
        <div class="featured-scroll">
            {% for listing in featured_listings %}
                <div class="featured-card">
                    <a href="{% url 'product-detail' listing_id=listing.id %}" style="text-decoration: none;">
                        <img src="{% if listing.images.first.image %}{{ listing.images.first.image.url }}{% else %}https://via.placeholder.com/300{% endif %}" alt="{{ listing.title }}">
                        <div class="featured-content">
                            <h3>{{ listing.title }}</h3>
                            <p>{{ listing.description|truncatechars:20 }}</p>
                            <span class="price">
                                {% if listing.price_type == 'free' %}
                                    Free
                                {% elif listing.price_type == 'hourly' %}
                                    â‚¦{{ listing.price }}/hr
                                {% else %}
                                    â‚¦{{ listing.price }}
                                {% endif %}
                            </span>
                        </div>
                    </a>
                </div>
            {% empty %}
                <p>No featured listings available.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Listings -->
    <div class="listings-section">
        <h2>Recent Listings</h2>
        <div class="listings-grid">
            {% for listing in recent_listings %}
                <div class="listing-card">
                    <div class="listing-image">
                        <a href="{% url 'product-detail' listing_id=listing.id %}">
                            <img src="{% if listing.images.first.image %}{{ listing.images.first.image.url }}{% else %}https://via.placeholder.com/150{% endif %}" alt="{{ listing.title }}">
                            {% if listing.created_at|timesince < "3 days" %}
                                <span class="listing-badge" style="text-transform: uppercase;">new</span>
                            {% elif listing.saves.count > 10 %}
                                <span class="listing-badge" style="text-transform: uppercase;">popular</span>
                            {% endif %}
                        </a>
                    </div>
                    <div class="listing-content">
                        <h3>{{ listing.title }}</h3>
                        <p>{{ listing.description|truncatechars:20 }}</p>
                        <div class="listing-footer">
                            <span class="price">
                                {% if listing.price_type == 'free' %}
                                    Free
                                {% elif listing.price_type == 'hourly' %}
                                    â‚¦{{ listing.price }}/hr
                                {% else %}
                                    â‚¦{{ listing.price }}
                                {% endif %}
                            </span> <br>
                            <span class="location">{{ listing.location }}</span>
                        </div>
                    </div>
                </div>
            {% empty %}
                <p>No recent listings available.</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

{% endblock %}

{% block scripts %}
    <script src="{% static 'UnivendApp/js/home.js' %}"></script>
{% endblock %}